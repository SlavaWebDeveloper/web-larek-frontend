# Проектная работа "Веб-ларек"

Стек: HTML, SCSS, TS, Webpack

Структура проекта:

- src/ — исходные файлы проекта
- src/components/ — папка с JS компонентами
- src/components/base/ — папка с базовым кодом

Важные файлы:

- src/pages/index.html — HTML-файл главной страницы
- src/types/index.ts — файл с типами
- src/index.ts — точка входа приложения
- src/styles/styles.scss — корневой файл стилей
- src/utils/constants.ts — файл с константами
- src/utils/utils.ts — файл с утилитами

## Установка и запуск

Для установки и запуска проекта необходимо выполнить команды

```
npm install
npm run start
```

или

```
yarn
yarn start
```

## Сборка

```
npm run build
```

или

```
yarn build
```

## Базовые классы

### Класс `Component<T>`

Абстрактный класс, является базовым классом для компонентов интерфейса, реализует методы для управления компонентами (изменение текста/изображения, переключение класса и рендер).

**Конструктор**

- Конструктор принимает элемент (HTMLElement), с которым будет происходить взаимодействие.

**Методы**

- setText: Устанавливает текстовое содержимое элемента.
- setImage: Устанавливает изображение и альтернативный текст для элемента img.
- toggleClass: Переключает CSS-класс элемента.
- setDisabled: Устанавливает или снимает атрибут disabled для элемента.
- render: Заполняет свойства элемента данными и возвращает его в формате HTMLElement.

### Класс `Api`

Класс для выполнения HTTP-запросов к API.

**Конструктор**

- constructor(baseUrl: string, options: RequestInit = {}): Принимает базовый URL для запросов и опции для настройки запросов.

**Методы**

- get(uri: string): Выполняет GET-запрос по указанному URI.
- post(uri: string, data: object, method: ApiPostMethods = 'POST'): Выполняет POST, PUT или DELETE запрос с указанными данными по указанному URI.
- handleResponse(response: Response): Обрабатывает ответ от - сервера, возвращает распарсенный JSON или ошибку.

### Класс `EventEmitter`

Класс для управления событиями и их подписчиками. Реализует паттерн _«Наблюдатель»_.

**Интерфейс IEvents**

```
export interface IEvents {
	on<T extends object>(event: EventName, callback: (data: T) => void): void;
	emit<T extends object>(event: string, data?: T): void;
	trigger<T extends object>(event: string, context?: Partial<T>): (data: T) => void;
}
```

**Типы и алиасы**

- EventName: Строка или регулярное выражение, определяющее имя события.
- Subscriber: Функция, которая будет вызвана при срабатывании события.
- EmitterEvent: Объект, содержащий имя события и данные события.

**Методы класса EventEmitter**

- constructor: Инициализирует внутреннюю структуру для хранения событий.
- on: Подписывает функцию обратного вызова на событие.
- off: Удаляет функцию обратного вызова с события.
- emit: Генерирует событие и вызывает все подписанные на него функции обратного вызова с переданными данными.
- onAll: Подписывает функцию обратного вызова на все события.
- offAll: Удаляет все подписчики на все события.
- trigger: Возвращает функцию-триггер, которая при вызове генерирует указанное событие с объединенными данными события и контекстом.

### Класс `Model<T>`

Абстрактный класс, представляющий базовую модель данных.

**Конструктор**

- Принимает частичные данные типа T и экземпляр класса IEvents для управления событиями.

**Методы**

- emitChanges: Генерирует событие с указанным именем и данными _payload_ при необходимости.

## Общие классы

Здесь представлены классы, расширяющие базовый класс _Component_ и реализующие различные компоненты интерфейса.

### Класс `Page`

Представляет страницу с возможностью управления элементами интерфейса.

Представляет компонент страницы с интерфейсом для управления элементами, такими как счётчик, каталог товаров и блокировка скролла.

**Конструктор**

- Принимает container - элемент, с которым будет взаимодействие, и events для управления событиями.

**Методы**

- counter: Устанавливает текстовое содержимое элемента counter.
- catalog: Заменяет содержимое элемента catalog на предоставленные элементы.
- locked: Управляет CSS-классом wrapper для блокировки скролла.

### Класс `Card`

Представляет карточку товара с возможностью управления её элементами.

Представляет компонент карточки товара с возможностью отображения заголовка, изображения, категории, цены и управления выбором товара.

**Конструктор**

- Принимает blockName - имя блока для поиска элементов, container - элемент, с которым будет взаимодействие, и необязательный объект actions для установки обработчика событий.

**Методы**

- id: Геттер и сеттер для уникального идентификатора элемента.
- title: Геттер и сеттер для названия товара.
- image: Сеттер для изображения товара.
- selected: Сеттер для определения выбран ли товар.
- price: Сеттер для цены товара.
- category: Сеттер для категории товара.

### Класс `StoreItem`

Представляет карточку товара для отображения в каталоге с базовым набором функций класса `Card`.

### Класс `StoreItemPreview`

Представляет карточку товара для предпросмотра с дополнительной функциональностью отображения описания товара.

**Методы**

- description: Устанавливает текстовое содержимое элемента description.

### Класс `CatalogProductBacket`

Представляет карточку товара в корзине с функциональностью отображения заголовка, индекса и цены товара.

**Конструктор**

- Принимает blockName - имя блока для поиска элементов, container - элемент, с которым будет взаимодействие, и необязательный объект actions для установки обработчика событий.

**Методы**

- title: Устанавливает текстовое содержимое элемента title (заголовок товара в корзине).
- index: Устанавливает текстовое содержимое элемента index (индекс товара в корзине).
- price: Устанавливает текстовое содержимое элемента price (цена товара в корзине).

### Класс `Basket`

Представляет компонент корзины товаров с функциональностью отображения списка товаров, общей стоимости, возможностью удаления и обновления элементов корзины.

**Конструктор**

- Принимает blockName - имя блока для поиска элементов, container - элемент, с которым будет взаимодействие, и events для управления событиями.

**Методы**

- list: Заменяет содержимое списка товаров list предоставленными элементами.
- total: Устанавливает текстовое содержимое элемента total (общая стоимость товаров в корзине).
- refreshIndices: Обновляет индексы элементов в корзине после удаления товара.
- setItems: Устанавливает элементы в корзину и управляет состоянием кнопки.
- disableButton: Отключает кнопку корзины.
- enableButton: Включает кнопку корзины.

### Класс `Form<T>`

Представляет компонент формы с возможностью управления вводимыми данными, валидации, отображения ошибок и отправки данных.

**Конструктор**

- Принимает container - HTML-элемент формы, с которым будет взаимодействие, и events для управления событиями.

**Методы**

- valid: Сеттер для установки состояния доступности кнопки отправки формы.
- errors: Сеттер для отображения сообщений об ошибках в форме.
- render: Метод для отображения текущего состояния формы.

### Класс `Modal`

Представляет модальное окно с возможностью отображения контента и управления его открытием и закрытием.

**Конструктор**

- Принимает container - HTML-элемент модального окна, с которым будет взаимодействие, и events для управления событиями.

**Методы**

- content: Сеттер для установки содержимого модального окна.
- open: Метод для открытия модального окна и генерации соответствующего события.
- close: Метод для закрытия модального окна, с удалением содержимого и генерацией соответствующего события.
- render: Метод для отображения модального окна с заданным содержимым.

### Класс `Order`

Представляет форму оформления заказа, наследует функциональность класса `Form`, дополняя управление способами оплаты.

**Конструктор**

- Принимает blockName - название блока формы, container - HTML-элемент формы заказа, events - объект для управления событиями.

**Методы**

- phone: Сеттер для установки значения в поле телефона.
- email: Сеттер для установки значения в поле электронной почты.
- address: Сеттер для установки значения в поле адреса.

### Класс `Success`

Представляет компонент для вывода информации о успешном списании с возможностью закрытия.

Класс Success предоставляет функциональность для отображения информации о успешном списании с возможностью закрытия блока.

**Конструктор**

- Принимает blockName - название блока компонента, container - HTML-элемент контейнера, actions - объект с действием при клике.

**Методы**

- description: Сеттер для установки описания успешного списания.

## Компоненты и модели данных (бизнес-логика)

### Класс `AppState`

Класс AppState представляет центральное состояние приложения, хранящее данные о состоянии корзины, каталоге продуктов, заказе и ошибках формы.

**Свойства**

- basket: Массив продуктов в корзине.
- catalog: Каталог продуктов.
- order: Информация о заказе, включая выбранные товары, способ оплаты, адрес доставки, email и телефон.
- formErrors: Ошибки валидации формы заказа.

**Методы**

- addToBasket: Добавление продукта в корзину.
- deleteFromBasket: Удаление продукта из корзины.
- clearBasket: Очистка корзины.
- getBasketAmount: Получение количества товаров в корзине.
- setItems: Установка выбранных товаров в заказ.
- setOrderField: Установка полей заказа (email, телефон, адрес и способ оплаты).
- validateContacts: Валидация контактных данных (email, телефон).
- validateOrder: Валидация данных заказа (адрес, способ оплаты).
- refreshOrder: Сброс информации о заказе.
- getTotalBasketPrice: Вычисление общей стоимости товаров в корзине.
- setStore: Установка каталога товаров.
- resetSelected: Сброс выбранных товаров в каталоге.

### Класс `LarekAPI`

Класс LarekAPI расширяет базовый класс Api и реализует интерфейс ILarekAPI, предоставляя методы для взаимодействия с API системы "Larek".

**Конструктор**

- baseUrl: базовый URL для API.
- options (необязательный): дополнительные параметры для настройки запросов.

**Методы**

- getProductList(): Асинхронно получает список карточек товаров.
  Возвращает Promise<IProduct[]>.
- getProductItem(id: UniqueId): Асинхронно получает карточку товара по идентификатору.
  Принимает id типа UniqueId.
  Возвращает Promise<IProduct>.
- orderProduct(order: IOrder): Асинхронно оформляет заказ.
  Принимает order типа IOrder.
  Возвращает Promise<IOrderResult>.

**Интерфейс ILarekAPI**
Описывает методы, которые должен реализовать класс LarekAPI:

- getProductList(): Возвращает список карточек товаров.
- getProductItem(id: UniqueId): Возвращает карточку товара по идентификатору.
- orderProduct(order: IOrder): Оформляет заказ.

## Типы данных и интерфейсы

### ProductCategory

Определяет категории продуктов с их строковыми значениями для типизации.

```
export const ProductCategory = {
	['софт-скил']: 'soft',
	['другое']: 'other',
	['кнопка']: 'button',
	['хард-скил']: 'hard',
	['дополнительное']: 'additional',
};
```

### currentCurrency

Определяет текущую валюту и значение для бесплатных товаров.

```
export const currentCurrency = {
	currency: ' синапсов',
	free: 'Бесценно',
};
```

### FormErrors

Объект, содержащий ошибки валидации для формы заказа.

```
export type FormErrors = Partial<Record<keyof IOrderForm, string>>;
```

### ApiListResponse<Type>

Ответ от API, содержащий общее количество элементов и массив элементов указанного типа.

```
export type ApiListResponse<Type> = {
total: PriceCents;
items: Type[];
};
```

### IProduct

Интерфейс, описывающий структуру товара в магазине.

```
  export interface IProduct {
	id: UniqueId;
	description: string;
	image: string;
	title: string;
	category: keyof typeof ProductCategory;
	price: PriceCents | null;
	selected: HasCart;
}
```

### IAppState

Интерфейс, описывающий внутреннее состояние приложения и его методы управления.

```
export interface IAppState {
	basket: Product[];
	store: Product[];
	order: IOrder;
	formErrors: FormErrors;
	addToBasket(value: Product): void;
	deleteFromBasket(id: string): void;
	clearBasket(): void;
	getBasketAmount(): number;
	getTotalBasketPrice(): number;
	setItems(): void;
	setOrderField(field: keyof IOrderForm, value: string): void;
	validateContacts(): boolean;
	validateOrder(): boolean;
	refreshOrder(): boolean;
	setStore(items: IProduct[]): void;
	resetSelected(): void;
}
```

### IOrder

Интерфейс, описывающий структуру заказа товара.

```
export interface IOrder {
	items: string[];
	payment: string;
	total: PriceCents;
	address: AddressString;
	email: EmailString;
	phone: PhoneString;
}
```

### IOrderResult

Интерфейс, описывающий результат выполнения заказа.

```
export interface IOrderResult {
	id: UniqueId[];
	total: PriceCents;
	error?: string;
}
```

### IOrderForm

Интерфейс, описывающий поля формы для заказа.

```
export interface IOrderForm {
	payment: string;
	address: AddressString;
	email: EmailString;
	phone: PhoneString;
}
```

### IContacts

Описывает поля модального окна контактов, включая телефон и электронную почту.

```
export interface IContacts {
	phone: PhoneString;
	email: EmailString;
}
```

### ILarekAPI

Интерфейс, описывающий методы API для работы с товарами и заказами.

```
export interface ILarekAPI {
	getProductList: () => Promise<IProduct[]>;
	getProductItem: (id: UniqueId) => Promise<IProduct>;
	orderProduct: (order: IOrder) => Promise<IOrderResult>;
}
```

## Основные аспекты работы приложения

1. Загрузка данных с сервера и инициализация приложения:

- Класс LarekAPI используется для работы с сервером и получения списка продуктов.
- api.getProductList() загружает список продуктов с сервера и передает их в appData.setStore(data), чтобы обновить состояние приложения.

2. Отображение каталога продуктов на странице:

- При событии items:changed создаются карточки продуктов (StoreItem) для каждого элемента из appData.catalog.
- Карточки отображаются на странице через page.catalog.

3. Выбор продукта и открытие модального окна с его описанием:

- При клике на карточку продукта (StoreItem), событие card:select открывает модальное окно.
- Модальное окно отображает детали выбранного продукта (StoreItemPreview).

4. Добавление продукта в корзину:

- По событию card:toBasket продукт добавляется в корзину через appData.addToBasket(item).
- Количество товаров в корзине обновляется на странице через page.counter.
- Модальное окно закрывается.

5. Открытие и управление корзиной:

- При клике на кнопку корзины (basket:open), открывается модальное окно с содержимым корзины.
- appData.basket используется для отображения элементов корзины.
- Модальное окно корзины обновляется через basket.setItems() и отображает общую стоимость.

6. Удаление продукта из корзины:

- При клике на кнопку удаления в карточке корзины (basket:delete), продукт удаляется из appData.basket.
- Корзина перерендеривается через basket.setItems(), индексы элементов обновляются через basket.refreshIndices().
- Общая стоимость корзины обновляется через basket.total.

7. Оформление заказа:

- По событию basket:order открывается модальное окно для оформления заказа (Order).
- После заполнения полей адреса и способа оплаты и клике на кнопку подтверждения (order:submit), открывается модальное окно для ввода контактных данных (Contacts).

8. Отправка заказа на сервер:

- При событии contacts:submit данные заказа отправляются на сервер через api.orderProduct(appData.order).
- По получении ответа (order:success), отображается модальное окно успешной покупки (Success).
- Корзина очищается (appData.clearBasket()), и данные обновляются на странице.

9. Закрытие модальных окон:

По событию modal:close модальные окна закрываются, страница разблокируется (page.locked = false).

## Основные способы взаимодейтсвия приложения

1. Инициируется при изменении списка товаров в магазине.
   После этого события страница перерисовывает каталог товаров.

```
'items:changed'
```

2. Инициируется при выборе карточки товара для отображения в модальном окне.
   Это событие блокирует доступ к другим элементам страницы.

```
'card:select'
```

3. Инициируется при добавлении товара в корзину.
   После этого события обновляется счётчик товаров в корзине.

```
'card:toBasket'
```

4. Инициируется при открытии корзины для просмотра содержимого.
   Это событие блокирует доступ к другим элементам страницы.

```
'basket:open'
```

5. Инициируется при удалении товара из корзины.
   После этого события обновляется счётчик товаров в корзине и пересчитывается общая стоимость.

```
'basket:delete'
```

6. Инициируется при переходе к оформлению заказа.
   После этого события отображается форма заказа.

```
'basket:order'
```

7. Инициируется при изменении состояния валидации формы заказа.
   После этого события отображается список ошибок, если они есть.

```
'orderFormErrors:change'
```

8. Инициируется при изменении состояния валидации формы контактов.
   После этого события отображается список ошибок, если они есть.

```
'contactsFormErrors:change'
```

9. Инициируется при изменении введенных данных в форме заказа.
   После этого события данные сохраняются в приложении.

```
'orderInput:change'
```

10. Инициируется при подтверждении оформления заказа.
    После этого события отображается форма для ввода контактных данных.

```
'order:submit'
```

11. Инициируется при отправке контактных данных для завершения оформления заказа.
    После этого события происходит отправка данных на сервер.

```
'contacts:submit'
```

12. Инициируется при успешном оформлении заказа.
    После этого события отображается окно с подтверждением и общей суммой заказа.

```
'order:success'
```

13. Инициируется при закрытии модального окна.
    После этого события разблокируются все элементы на странице.

```
'modal:close'
```
